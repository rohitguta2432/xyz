!function(t){"object"==typeof exports?t(require("jquery")):"function"==typeof define&&define.amd?define(["jquery"],t):t(jQuery)}(function(t){"use strict";var e=function(t,e){if("string"!=typeof e||e.length){var i="string"==typeof e?new RegExp(e,"i"):e,s=function(t){var e=0;if(3===t.nodeType){var n=t.data.search(i);if(n>=0&&t.data.length>0){var o=t.data.match(i),r=document.createElement("span");r.className="highlight";var a=t.splitText(n),h=(a.splitText(o[0].length),a.cloneNode(!0));r.appendChild(h),a.parentNode.replaceChild(r,a),e=1}}else if(1===t.nodeType&&t.childNodes&&!/(script|style)/i.test(t.tagName))for(var l=0;l<t.childNodes.length;++l)l+=s(t.childNodes[l]);return e};return t.each(function(){s(this)})}},i=/Mac/.test(navigator.userAgent),s=i?18:17,n={a:"[aÃ€ÃÃ‚ÃƒÃ„Ã…Ã Ã¡Ã¢Ã£Ã¤Ã¥]",c:"[cÃ‡Ã§]",e:"[eÃˆÃ‰ÃŠÃ‹Ã¨Ã©ÃªÃ«]",i:"[iÃŒÃÃŽÃÃ¬Ã­Ã®Ã¯]",n:"[nÃ‘Ã±]",o:"[oÃ’Ã“Ã”Ã•Ã•Ã–Ã˜Ã²Ã³Ã´ÃµÃ¶Ã¸]",s:"[sÅ Å¡]",u:"[uÃ™ÃšÃ›ÃœÃ¹ÃºÃ»Ã¼]",y:"[yÅ¸Ã¿Ã½]",z:"[zÅ½Å¾]"},o={delimiter:",",persist:!0,diacritics:!0,create:!1,highlight:!0,openOnFocus:!0,maxOptions:1e3,maxItems:null,hideSelected:null,scrollDuration:60,loadThrottle:300,dataAttr:"data-data",sortField:null,sortDirection:"asc",valueField:"value",labelField:"text",searchField:["text"],mode:null,theme:"default",wrapperClass:"selectize-control",inputClass:"selectize-input",dropdownClass:"selectize-dropdown",load:null,score:null,onChange:null,onItemAdd:null,onItemRemove:null,onClear:null,onOptionAdd:null,onOptionRemove:null,onDropdownOpen:null,onDropdownClose:null,onType:null,render:{item:null,option:null,option_create:null}};t.fn.selectize=function(e){var i=t.fn.selectize.defaults;return e=e||{},this.each(function(){var s,n,o,r,a,h,l,p,c,u,d,g=t(this);if(c=g[0].tagName.toLowerCase(),"string"==typeof e)(s=g.data("selectize"))[e].apply(s,Array.prototype.splice.apply(arguments,1));else{if(l=e.dataAttr||i.dataAttr,p={},p.placeholder=g.attr("placeholder"),p.options={},p.items=[],"select"===c)for(p.maxItems=g.attr("multiple")?null:1,r=0,a=(u=g.children()).length;r<a;r++)(n=(d=t(u[r])).attr("value")||"").length&&("string"==typeof(h=l&&d.attr(l)||{text:d.html(),value:n})&&(h=JSON.parse(h)),p.options[n]=h,d.is(":selected")&&p.items.push(n));else if((n=t.trim(g.val()||"")).length){for(r=0,a=(o=n.split(e.delimiter||i.delimiter)).length;r<a;r++)p.options[o[r]]={text:o[r],value:o[r]};p.items=o}s=new m(g,t.extend(!0,{},i,p,e)),g.data("selectize",s),g.addClass("selectized")}})},t.fn.selectize.defaults=o;var r=function(t){return void 0!==t},a=function(t){return String(t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")},h=function(t){return(t+"").replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1")},l=function(t){var e=!1;return function(){e||(e=!0,t.apply(this,arguments))}},p=function(t,e){var i;return function(){var s=this,n=arguments;window.clearTimeout(i),i=window.setTimeout(function(){t.apply(s,n)},e)}},c=function(t,e,i,s){t.on(e,i,function(e){for(var i=e.target;i&&i.parentNode!==t[0];)i=i.parentNode;return e.currentTarget=i,s.apply(this,[e])})},u=function(t){var e={};if("selectionStart"in t)e.start=t.selectionStart,e.length=t.selectionEnd-e.start;else if(document.selection){t.focus();var i=document.selection.createRange(),s=document.selection.createRange().text.length;i.moveStart("character",-t.value.length),e.start=i.text.length-s,e.length=s}return e},d=function(t,e,i){var s={};if(i)for(var n=0;n<i.length;n++)s[i[n]]=t.css(i[n]);else s=t.css();return e.css(s),e},g=function(e,i){var s=t("<test>").css({position:"absolute",top:-99999,left:-99999,width:"auto",padding:0,whiteSpace:"nowrap"}).text(e).appendTo("body");d(i,s,["letterSpacing","fontSize","fontFamily","fontWeight","textTransform"]);var n=s.width();return s.remove(),n},f=function(t){var e=function(e){var i,s,n,o,r,a;e=e||window.event,i=t.val(),e.type&&"keydown"===e.type.toLowerCase()&&((s=e.keyCode)>=97&&s<=122||s>=65&&s<=90||s>=48&&s<=57||32==s)&&(r=e.shiftKey,a=String.fromCharCode(e.keyCode),i+=a=r?a.toUpperCase():a.toLowerCase()),n=t.attr("placeholder")||"",!i.length&&n.length&&(i=n),(o=g(i,t)+4)!==t.width()&&(t.width(o),t.triggerHandler("resize"))};t.on("keydown keyup update blur",e),e({})},m=function(e,i){if(e[0].selectize=this,this.$input=e,this.tagType="select"===e[0].tagName.toLowerCase()?1:2,this.settings=i,this.highlightedValue=null,this.isOpen=!1,this.isLocked=!1,this.isFocused=!1,this.isInputFocused=!1,this.isSetup=!1,this.isShiftDown=!1,this.isCtrlDown=!1,this.ignoreFocus=!1,this.hasOptions=!1,this.currentResults=null,this.lastValue="",this.caretPos=0,this.loading=0,this.loadedSearches={},this.$activeOption=null,this.$activeItems=[],this.options={},this.userOptions={},this.items=[],this.renderCache={},this.onSearchChange=p(this.onSearchChange,this.settings.loadThrottle),t.isArray(i.options))for(var s=i.valueField,n=0;n<i.options.length;n++)i.options[n].hasOwnProperty(s)&&(this.options[i.options[n][s]]=i.options[n]);else"object"==typeof i.options&&(t.extend(this.options,i.options),delete this.settings.options);this.settings.mode=this.settings.mode||(1===this.settings.maxItems?"single":"multi"),"boolean"!=typeof this.settings.hideSelected&&(this.settings.hideSelected="multi"===this.settings.mode),this.setup()};return m.prototype.setup=function(){var e,n,o,r,a,h,l=this;e=t("<div>").addClass(this.settings.theme).addClass(this.settings.wrapperClass),n=t("<div>").addClass(this.settings.inputClass).addClass("items").toggleClass("has-options",!t.isEmptyObject(this.options)).appendTo(e),o=t('<input type="text">').appendTo(n),r=t("<div>").addClass(this.settings.dropdownClass).hide().appendTo(e),h=this.$input.css("display"),e.css({width:this.$input[0].style.width,display:h}),a=this.settings.mode,e.toggleClass("single","single"===a),e.toggleClass("multi","multi"===a),(null===this.settings.maxItems||this.settings.maxItems>1)&&1===this.tagType&&this.$input.attr("multiple","multiple"),this.settings.placeholder&&o.attr("placeholder",this.settings.placeholder),this.$wrapper=e,this.$control=n,this.$control_input=o,this.$dropdown=r,n.on("mousedown",function(t){t.currentTarget===l.$control[0]?o.trigger("focus"):l.focus(!0),t.preventDefault()}),c(r,"mouseenter","*",function(){return l.onOptionHover.apply(l,arguments)}),c(r,"mousedown","*",function(){return l.onOptionSelect.apply(l,arguments)}),c(n,"mousedown","*:not(input)",function(){return l.onItemSelect.apply(l,arguments)}),f(o),o.on({mousedown:function(t){t.stopPropagation()},keydown:function(){return l.onKeyDown.apply(l,arguments)},keyup:function(){return l.onKeyUp.apply(l,arguments)},keypress:function(){return l.onKeyPress.apply(l,arguments)},resize:function(){l.positionDropdown.apply(l,[])},blur:function(){return l.onBlur.apply(l,arguments)},focus:function(){return l.onFocus.apply(l,arguments)}}),t(document).on({keydown:function(t){if(l.isCtrlDown=t[i?"altKey":"ctrlKey"],l.isShiftDown=t.shiftKey,l.isFocused&&!l.isLocked){var e=(t.target.tagName||"").toLowerCase();if("input"===e||"textarea"===e)return;if(-1!==[16,8,46,27,37,39,9].indexOf(t.keyCode))return l.onKeyDown.apply(l,arguments)}},keyup:function(t){t.keyCode===s?l.isCtrlDown=!1:16===t.keyCode&&(l.isShiftDown=!1)},mousedown:function(t){!l.isFocused||l.isLocked||l.$control.has(t.target).length||t.target===l.$control[0]||l.blur()}}),t(window).on({resize:function(){l.isOpen&&l.positionDropdown.apply(l,arguments)}}),this.$input.hide().after(this.$wrapper),t.isArray(this.settings.items)&&(this.setValue(this.settings.items),delete this.settings.items),this.updateOriginalInput(),this.refreshItems(),this.updatePlaceholder(),this.isSetup=!0},m.prototype.trigger=function(t){var e;"function"==typeof this.settings[t]&&(e=Array.prototype.slice.apply(arguments,[1]),this.settings.event.apply(this,e))},m.prototype.onKeyPress=function(t){if(!this.isLocked){var e=String.fromCharCode(t.keyCode||t.which);return this.settings.create&&e===this.settings.delimiter?(this.createItem(),t.preventDefault(),!1):void 0}},m.prototype.onKeyDown=function(e){if(!this.isLocked){e.target,this.$control_input[0];switch(e.keyCode||e.which){case 27:return void this.blur();case 40:if(!this.isOpen&&this.hasOptions&&this.isInputFocused)this.open();else if(this.$activeOption){var i=this.$activeOption.next();i.length&&this.setActiveOption(i,!0,!0)}e.preventDefault();break;case 38:if(this.$activeOption){var s=this.$activeOption.prev();s.length&&this.setActiveOption(s,!0,!0)}e.preventDefault();break;case 13:this.$activeOption&&this.onOptionSelect({currentTarget:this.$activeOption}),e.preventDefault();break;case 37:this.advanceSelection(-1,e);break;case 39:this.advanceSelection(1,e);break;case 9:this.settings.create&&t.trim(this.$control_input.val()).length&&(this.createItem(),e.preventDefault());break;case 8:case 46:this.deleteSelection(e);break;default:if(this.isFull())return void e.preventDefault()}this.isFull()||this.focus(!0)}},m.prototype.onKeyUp=function(t){if(!this.isLocked){var e=this.$control_input.val()||"";this.lastValue!==e&&(this.lastValue=e,this.onSearchChange(e),this.refreshOptions(),this.trigger("onType",e))}},m.prototype.onSearchChange=function(t){if(this.settings.load&&!this.loadedSearches.hasOwnProperty(t)){var e=this,i=this.$wrapper.addClass("loading");this.loading++,this.loadedSearches[t]=!0,this.settings.load.apply(this,[t,function(t){e.loading=Math.max(e.loading-1,0),t&&t.length&&(e.addOption(t),e.refreshOptions(!1),e.isInputFocused&&e.open()),e.loading||i.removeClass("loading")}])}},m.prototype.onFocus=function(t){this.showInput(),this.isInputFocused=!0,this.ignoreFocus||(this.setActiveItem(null),this.$control.addClass("focus"),this.refreshOptions(!!this.settings.openOnFocus))},m.prototype.onBlur=function(t){this.isInputFocused=!1,this.ignoreFocus||(this.close(),this.$control_input.val(""),this.setActiveOption(null),this.setCaret(this.items.length,!1),this.$activeItems.length||(this.$control.removeClass("focus"),this.isFocused=!1))},m.prototype.onOptionHover=function(t){this.setActiveOption(t.currentTarget,!1)},m.prototype.onOptionSelect=function(e){var i=t(e.currentTarget);if(i.hasClass("create"))this.createItem();else{var s=i.attr("data-value");if(s){this.addItem(s),this.$control_input.val("");var n=this;window.setTimeout(function(){"single"===n.settings.mode?(n.blur(),n.focus(!1),n.hideInput()):n.focus(!1)},0)}}},m.prototype.onItemSelect=function(t){"multi"===this.settings.mode&&(this.$control_input.trigger("blur"),this.setActiveItem(t.currentTarget,t),t.stopPropagation())},m.prototype.getValue=function(){return 1===this.tagType&&this.$input.attr("multiple")?this.items:this.items.join(this.settings.delimiter)},m.prototype.setValue=function(e){this.clear();for(var i=t.isArray(e)?e:[e],s=0,n=i.length;s<n;s++)this.addItem(i[s])},m.prototype.setActiveItem=function(e,i){var s,n,o,r,a,h,l,p;if(!(e=t(e)).length)return t(this.$activeItems).removeClass("active"),this.$activeItems=[],void(this.isFocused=!1);if("mousedown"===(s=i&&i.type.toLowerCase())&&this.isShiftDown&&this.$activeItems.length){for(p=this.$control.children(".active:last"),(r=Array.prototype.indexOf.apply(this.$control[0].childNodes,[p[0]]))>(a=Array.prototype.indexOf.apply(this.$control[0].childNodes,[e[0]]))&&(l=r,r=a,a=l),n=r;n<=a;n++)h=this.$control[0].childNodes[n],-1===this.$activeItems.indexOf(h)&&(t(h).addClass("active"),this.$activeItems.push(h));i.preventDefault()}else"mousedown"===s&&this.isCtrlDown||"keydown"===s&&this.isShiftDown?e.hasClass("active")?(o=this.$activeItems.indexOf(e[0]),this.$activeItems.splice(o,1),e.removeClass("active")):this.$activeItems.push(e.addClass("active")[0]):(t(this.$activeItems).removeClass("active"),this.$activeItems=[e.addClass("active")[0]]);this.isFocused=!!this.$activeItems.length},m.prototype.setActiveOption=function(e,i,s){var n,o,a,h,l;this.$activeOption&&this.$activeOption.removeClass("active"),this.$activeOption=null,(e=t(e)).length&&(this.$activeOption=e.addClass("active"),!i&&r(i)||(n=this.$dropdown.height(),o=this.$activeOption.outerHeight(!0),i=this.$dropdown.scrollTop()||0,h=a=this.$activeOption.offset().top-this.$dropdown.offset().top+i,l=a-n+o,a+o>n-i?this.$dropdown.stop().animate({scrollTop:l},s?this.settings.scrollDuration:0):a<i&&this.$dropdown.stop().animate({scrollTop:h},s?this.settings.scrollDuration:0)))},m.prototype.hideInput=function(){this.$control_input.css({opacity:0}),this.isInputFocused=!1},m.prototype.showInput=function(){this.$control_input.css({opacity:1})},m.prototype.focus=function(t){var e=this.ignoreFocus;this.ignoreFocus=!t,this.$control_input[0].focus(),this.ignoreFocus=e},m.prototype.blur=function(){this.$control_input.trigger("blur"),this.setActiveItem(null)},m.prototype.parseSearchTokens=function(e){if(!(e=t.trim(String(e||"").toLowerCase()))||!e.length)return[];var i,s,o,r,a=[],l=e.split(/ +/);for(i=0,s=l.length;i<s;i++){if(o=h(l[i]),this.settings.diacritics)for(r in n)n.hasOwnProperty(r)&&(o=o.replace(new RegExp(r,"g"),n[r]));a.push({string:l[i],regex:new RegExp(o,"i")})}return a},m.prototype.getScoreFunction=function(t){var e=this,i=t.tokens,s=function(){return i.length?1===i.length?function(t){var e,s;return t=String(t||"").toLowerCase(),-1===(s=t.search(i[0].regex))?0:(e=i[0].string.length/t.length,0===s&&(e+=.5),e)}:function(t){var e,s,n,o;for(t=String(t||"").toLowerCase(),e=0,n=0,o=i.length;n<o;n++){if(-1===(s=t.search(i[n].regex)))return 0;0===s&&(e+=.5),e+=i[n].string.length/t.length}return e/i.length}:function(){return 0}}();return function(){var t=e.settings.searchField;if("string"==typeof t&&(t=[t]),t&&t.length){if(1===t.length){var i=t[0];return function(t){return t.hasOwnProperty(i)?s(t[i]):0}}return function(e){for(var i=0,n=0,o=0,r=t.length;o<r;o++)e.hasOwnProperty(t[o])&&(n+=s(e[t[o]]),i++);return n/i}}return function(){return 0}}()},m.prototype.search=function(e,i){var s,n,o,r,a=this;if(i=i||{},(e=t.trim(String(e||"").toLowerCase()))!==this.lastQuery){if(this.lastQuery=e,o={query:e,tokens:this.parseSearchTokens(e),total:0,items:[]},this.settings.score){if("function"!=typeof(r=this.settings.score.apply(this,[o])))throw new Error('Selectize "score" setting must be a function that returns a function')}else r=this.getScoreFunction(o);if(e.length){for(s in this.options)this.options.hasOwnProperty(s)&&(n=r(this.options[s]))>0&&o.items.push({score:n,value:s});o.items.sort(function(t,e){return e.score-t.score})}else{for(s in this.options)this.options.hasOwnProperty(s)&&o.items.push({score:1,value:s});this.settings.sortField&&o.items.sort(function(){var t=a.settings.sortField,e="desc"===a.settings.sortDirection?-1:1;return function(i,s){return i=i&&String(a.options[i.value][t]||"").toLowerCase(),s=s&&String(a.options[s.value][t]||"").toLowerCase(),i>s?1*e:s>i?-1*e:0}}())}this.currentResults=o}else o=t.extend(!0,{},this.currentResults);return this.prepareResults(o,i)},m.prototype.prepareResults=function(t,e){if(this.settings.hideSelected)for(var i=t.items.length-1;i>=0;i--)-1!==this.items.indexOf(String(t.items[i].value))&&t.items.splice(i,1);return t.total=t.items.length,"number"==typeof e.limit&&(t.items=t.items.slice(0,e.limit)),t},m.prototype.refreshOptions=function(t){void 0===t&&(t=!0);var i,s,n,o=this.$control_input.val(),r=this.search(o,{}),a=[];for(s=r.items.length,"number"==typeof this.settings.maxOptions&&(s=Math.min(s,this.settings.maxOptions)),i=0;i<s;i++)a.push(this.render("option",this.options[r.items[i].value]));if(this.$dropdown.html(a.join("")),this.settings.highlight&&r.query.length&&r.tokens.length)for(i=0,s=r.tokens.length;i<s;i++)e(this.$dropdown,r.tokens[i].regex);if(!this.settings.hideSelected)for(i=0,s=this.items.length;i<s;i++)this.getOption(this.items[i]).addClass("selected");(n=this.settings.create&&r.query.length)&&this.$dropdown.prepend(this.render("option_create",{input:o})),this.hasOptions=r.items.length>0||n,this.hasOptions?(this.setActiveOption(this.$dropdown[0].childNodes[n&&r.items.length>0?1:0]),t&&!this.isOpen&&this.open()):(this.setActiveOption(null),t&&this.isOpen&&this.close())},m.prototype.addOption=function(e,i){if(t.isArray(e))for(var s=0,n=e.length;s<n;s++)this.addOption(e[s][this.settings.valueField],e[s]);else this.options.hasOwnProperty(e)||(e=String(e),this.userOptions[e]=!0,this.options[e]=i,this.lastQuery=null,this.trigger("onOptionAdd",e,i))},m.prototype.updateOption=function(e,i){if(e=String(e),this.options[e]=i,r(this.renderCache.item)&&delete this.renderCache.item[e],r(this.renderCache.option)&&delete this.renderCache.option[e],-1!==this.items.indexOf(e)){var s=this.getItem(e),n=t(this.render("item",i));s.hasClass("active")&&n.addClass("active"),s.replaceWith(n)}this.isOpen&&this.refreshOptions(!1)},m.prototype.removeOption=function(t){t=String(t),delete this.userOptions[t],delete this.options[t],this.lastQuery=null,this.trigger("onOptionRemove",t)},m.prototype.getOption=function(t){return this.$dropdown.children('[data-value="'+t.replace(/(['"])/g,"\\$1")+'"]:first')},m.prototype.getItem=function(e){var i=this.items.indexOf(e);if(-1!==i){i>=this.caretPos&&i++;var s=t(this.$control[0].childNodes[i]);if(s.attr("data-value")===e)return s}return t()},m.prototype.addItem=function(e){var i,s=this.settings.mode,n=this.isFull();if(e=String(e),"single"===s&&this.clear(),("multi"!==s||!n)&&-1===this.items.indexOf(e)&&this.options.hasOwnProperty(e)&&(i=t(this.render("item",this.options[e])),this.items.splice(this.caretPos,0,e),this.insertAtCaret(i),n=this.isFull(),this.$control.toggleClass("has-items",!0),this.$control.toggleClass("full",n).toggleClass("not-full",!n),this.isSetup)){for(var o=this.$dropdown[0].childNodes,r=0;r<o.length;r++){var a=t(o[r]);if(a.attr("data-value")===e){a.remove(),a[0]===this.$activeOption[0]&&this.setActiveOption(o.length?t(o[0]).addClass("active"):null);break}}!o.length||null!==this.settings.maxItems&&this.items.length>=this.settings.maxItems?this.close():this.positionDropdown(),this.updatePlaceholder(),this.updateOriginalInput(),this.trigger("onItemAdd",e,i)}},m.prototype.removeItem=function(t){var e,i,s;e="object"==typeof t?t:this.getItem(t),t=String(e.attr("data-value")),-1!==(i=this.items.indexOf(t))&&(e.remove(),e.hasClass("active")&&(s=this.$activeItems.indexOf(e[0]),this.$activeItems.splice(s,1)),this.items.splice(i,1),this.$control.toggleClass("has-items",this.items.length>0),this.$control.removeClass("full").addClass("not-full"),this.lastQuery=null,!this.settings.persist&&this.userOptions.hasOwnProperty(t)&&this.removeOption(t),this.setCaret(i),this.positionDropdown(),this.refreshOptions(!1),this.hasOptions?this.isInputFocused&&this.open():this.close(),this.updatePlaceholder(),this.updateOriginalInput(),this.trigger("onItemRemove",t))},m.prototype.createItem=function(){var e=this,i=t.trim(this.$control_input.val()||""),s=this.caretPos;if(i.length){this.lock(),this.$control_input[0].blur();var n="function"==typeof this.settings.create?this.settings.create:function(t){var i={};return i[e.settings.labelField]=t,i[e.settings.valueField]=t,i},o=l(function(t){e.unlock(),e.$control_input[0].focus();var i=t&&t[e.settings.valueField];i&&(e.addOption(i,t),e.setCaret(s,!1),e.addItem(i),e.refreshOptions(!1),e.$control_input.val(""))}),r=n(i,o);"object"==typeof r&&o(r)}},m.prototype.refreshItems=function(){var t=this.isFull();if(this.lastQuery=null,this.$control.toggleClass("full",t).toggleClass("not-full",!t),this.$control.toggleClass("has-items",this.items.length>0),this.isSetup)for(var e=0;e<this.items.length;e++)this.addItem(this.items);this.updateOriginalInput()},m.prototype.isFull=function(){return null!==this.settings.maxItems&&this.items.length>=this.settings.maxItems},m.prototype.updateOriginalInput=function(){var t,e,i;if("select"===this.$input[0].tagName.toLowerCase()){for(i=[],t=0,e=this.items.length;t<e;t++)i.push('<option value="'+a(this.items[t])+'" selected="selected"></option>');i.length||this.$input.attr("multiple")||i.push('<option value="" selected="selected"></option>'),this.$input.html(i.join(""))}else this.$input.val(this.getValue());this.$input.trigger("change"),this.isSetup&&this.trigger("onChange",this.$input.val())},m.prototype.updatePlaceholder=function(){if(this.settings.placeholder){var t=this.$control_input;this.items.length?t.removeAttr("placeholder"):t.attr("placeholder",this.settings.placeholder),t.triggerHandler("update")}},m.prototype.open=function(){this.isOpen||"multi"===this.settings.mode&&this.isFull()||(this.isOpen=!0,this.positionDropdown(),this.$control.addClass("dropdown-active"),this.$dropdown.show(),this.trigger("onDropdownOpen",this.$dropdown))},m.prototype.close=function(){this.isOpen&&(this.$dropdown.hide(),this.$control.removeClass("dropdown-active"),this.isOpen=!1,this.trigger("onDropdownClose",this.$dropdown))},m.prototype.positionDropdown=function(){var t=this.$control,e=t.position();e.top+=t.outerHeight(!0),this.$dropdown.css({width:t.outerWidth(),top:e.top,left:e.left})},m.prototype.clear=function(){this.items.length&&(this.$control.removeClass("has-items"),this.$control.children(":not(input)").remove(),this.items=[],this.setCaret(0),this.updatePlaceholder(),this.updateOriginalInput(),this.trigger("onClear"))},m.prototype.insertAtCaret=function(e){var i=Math.min(this.caretPos,this.items.length);0===i?this.$control.prepend(e):t(this.$control[0].childNodes[i]).before(e),this.setCaret(i+1)},m.prototype.deleteSelection=function(e){var i,s,n,o,r,a,h;if(n=8===e.keyCode?-1:1,o=u(this.$control_input[0]),this.$activeItems.length){for(h=this.$control.children(".active:"+(n>0?"last":"first")),a=Array.prototype.indexOf.apply(this.$control[0].childNodes,[h[0]]),this.$activeItems.length>1&&n>0&&a--,r=[],i=0,s=this.$activeItems.length;i<s;i++)r.push(t(this.$activeItems[i]).attr("data-value"));for(;r.length;)this.removeItem(r.pop());this.setCaret(a),e.preventDefault(),e.stopPropagation()}else(this.isInputFocused||"single"===this.settings.mode)&&this.items.length&&(n<0&&0===o.start&&0===o.length?this.removeItem(this.items[this.caretPos-1]):n>0&&o.start===this.$control_input.val().length&&this.removeItem(this.items[this.caretPos]))},m.prototype.advanceSelection=function(t,e){if(0!==t){var i=t>0?"last":"first",s=u(this.$control_input[0]);if(this.isInputFocused){var n=this.$control_input.val().length;(t<0?0===s.start&&0===s.length:s.start===n)&&!n&&this.advanceCaret(t,e)}else{var o=this.$control.children(".active:"+i);if(o.length){var r=Array.prototype.indexOf.apply(this.$control[0].childNodes,[o[0]]);this.setCaret(t>0?r+1:r)}}}},m.prototype.advanceCaret=function(t,e){if(0!==t){var i=t>0?"next":"prev";if(this.isShiftDown){var s=this.$control_input[i]();s.length&&(this.blur(),this.setActiveItem(s),e&&e.preventDefault())}else this.setCaret(this.caretPos+t)}},m.prototype.setCaret=function(t,e){t="single"===this.settings.mode||this.isFull()?this.items.length:Math.max(0,Math.min(this.items.length,t)),this.ignoreFocus=!0,this.$control_input.detach(),t===this.items.length?this.$control.append(this.$control_input):this.$control_input.insertBefore(this.$control.children(":not(input)")[t]),this.ignoreFocus=!1,e&&this.isSetup&&this.focus(!0),this.caretPos=t},m.prototype.lock=function(){this.isLocked=!0,this.$control.addClass("locked")},m.prototype.unlock=function(){this.isLocked=!1,this.$control.removeClass("locked")},m.prototype.render=function(t,e){o=!r(o)||o;var i,s,n="",o=!1;if(-1!==["option","item"].indexOf(t)&&(i=e[this.settings.valueField],o=r(i)),o&&(r(this.renderCache[t])||(this.renderCache[t]={}),this.renderCache[t].hasOwnProperty(i)))return this.renderCache[t][i];if(this.settings.render&&"function"==typeof this.settings.render[t])n=this.settings.render[t].apply(this,[e]);else switch(s=e[this.settings.labelField],t){case"option":n='<div class="option">'+s+"</div>";break;case"item":n='<div class="item">'+s+"</div>";break;case"option_create":n='<div class="create">Create <strong>'+a(e.input)+"</strong>&hellip;</div>"}return r(i)&&(n=n.replace(/^[\	 ]*<([a-z][a-z0-9\-_]*(?:\:[a-z][a-z0-9\-_]*)?)/i,'<$1 data-value="'+i+'"')),o&&(this.renderCache[t][i]=n),n},m});
